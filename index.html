<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Php-band by francisek</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Php-band</h1>
      <h2 class="project-tagline">A bash application to manage compilation of multiple php versions</h2>
      <a href="https://github.com/francisek/php-band" class="btn">View on GitHub</a>
      <a href="https://github.com/francisek/php-band/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/francisek/php-band/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="php-band" class="anchor" href="#php-band" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>php-band</h1>

<p><img src="https://circleci.com/gh/francisek/php-band/tree/master.svg?style=shield&amp;circle-token=0e2b5681405bbc52e77bce982d74c449b46636d8"></p>

<p>A simple bash tool to compile php versions</p>

<h1>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h1>

<p>Just clone the repository</p>

<pre><code>git clone git@github.com:francisek/php-band
</code></pre>

<h1>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Requirements</h1>

<p>To compile a PHP version, you will need:</p>

<ul>
<li>a bash shell with which, tar, sed and wget commands available </li>
<li>any requirement for PHP compilation (<a href="http://php.net/manual/en/install.unix.php">http://php.net/manual/en/install.unix.php</a>)</li>
</ul>

<h1>
<a id="using-php-band" class="anchor" href="#using-php-band" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using php-band</h1>

<p>Run</p>

<pre><code>bin/php-band --help
</code></pre>

<p>to get help on how to run this tool.</p>

<h1>
<a id="running-tests" class="anchor" href="#running-tests" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running tests</h1>

<p>The test suite uses the bats framework.
Install it from repository:</p>

<pre><code>git clone --depth 1 git@github.com:sstephenson/bats.git
</code></pre>

<p>Then run the tests :</p>

<pre><code>./bats/bin/bats tests
</code></pre>

<p>if you want also to fully compile php while testing, you have to set the environment variable PHP_BAND_TEST_COMPILATION.</p>

<h1>
<a id="the-compilation-process" class="anchor" href="#the-compilation-process" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The compilation process</h1>

<p>What does php-band is :</p>

<ul>
<li>check the validity of the version</li>
<li>if it does not exist, attempts to download the php archive from a list of prefered sites</li>
<li>if the php source directory does not exist, extract it from the archive into src directory</li>
<li>switches to php tource directory</li>
<li>reads per-version configuration</li>
<li>if not already, configures php:

<ul>
<li>runs the <em>pre_configure_php()</em> function</li>
<li>runs configure</li>
<li>runs the <em>post_configure_php()</em> function if configure was successfull</li>
<li>marks the version as configured</li>
</ul>
</li>
<li>if not already compiled

<ul>
<li>runs the <em>pre_compile_php()</em> function</li>
<li>compiles php</li>
<li>runs the <em>post_compile_php()</em> function if compilation was successfull</li>
<li>marks the version as built</li>
</ul>
</li>
<li>installs php to inst/</li>
<li>runs <em>post_install_php()</em> function if installation was successfull</li>
</ul>

<h1>
<a id="custom-configuration" class="anchor" href="#custom-configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Custom configuration</h1>

<h2>
<a id="how-it-works" class="anchor" href="#how-it-works" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How it works</h2>

<p>You can define custom configuration to plot any version.
The version-independant configurations reside in the <em>config</em> directory.
The you can plot a specific version configuration in a version-like subtree of the <em>config</em> directory.
To get it clear, look at this example of config tree:</p>

<pre><code>./config
  + configure-php.sh
  + 5/
    + configure-php.sh
    + 6/
      + configure-php.sh
</code></pre>

<p>php-band will use first <em>./config/configure-php.sh</em> for any version.
Then if major version is 5, <em>./config/5/configure-php.sh</em> overrides the previous configuration.
Then if major version is 5 and minor version is 6, <em>.config/5/6/configure-php.sh</em> overrides the previous configuration.
And so on ...</p>

<h2>
<a id="what-you-can-do" class="anchor" href="#what-you-can-do" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What you can do</h2>

<p>Each version-matching <em>configure-php.sh</em> file is sourced into php-band with the version components as arguments (major, minor, patch and addon).
You can define some variables and functions to customize the version you are installing.</p>

<h2>
<a id="alterable-variables-and-functions" class="anchor" href="#alterable-variables-and-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Alterable variables and functions</h2>

<ul>
<li>
<em>php_band_php_config_options</em> takes any argument that php's <em>configure</em> accepts except "--prefix" and "--exec-prefix".
Its default value is defined to "--disable-all".</li>
<li>
<em>pre_configure_php()</em> is called before php's <em>configure</em>
</li>
<li>
<em>post_configure_php()</em> is called after a successfull php's <em>configure</em>
</li>
<li>
<em>pre_compile_php()</em> is called before php's <em>make</em>
</li>
<li>
<em>post_compile_php()</em> is called after a successfull php's <em>make</em>
</li>
<li>
<em>post_install_php()</em> is called after a successfull php's <em>make install</em>
</li>
</ul>

<h2>
<a id="readonly-variables" class="anchor" href="#readonly-variables" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Readonly variables</h2>

<p>Those variables can be used but should not be modified:</p>

<ul>
<li>
<em>PHP_BAND_INST_DIR</em> Directory for all installations</li>
<li>
<em>PHP_BAND_SOURCE_DIR</em> Directory for all sources</li>
<li>
<em>php_band_php_install_dir</em> Directory into wich the current php will installed</li>
<li>*php_version}} The full php version string (for example 5.6.3RC2)</li>
<li>
<em>php_version_major</em> The php major version (for example 5)</li>
<li>
<em>php_version_minor</em> The php minor version (for example 6)</li>
<li>
<em>php_version_patch</em> The php patch version (for example 3)</li>
<li>
<em>php_version_addon</em> The php version (for example RC2)</li>
<li>
<em>php_band_php_install_dir</em> The directory where php is installed</li>
</ul>

<h2>
<a id="usefull-functions" class="anchor" href="#usefull-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usefull functions</h2>

<p>Some core functions may be usefull in your functions :</p>

<ul>
<li>
<em>error_exit(error_message [, error_code])</em> 
Displays the error_message and exits error_code</li>
<li>
<em>log_info(message)</em> 
Displays a message</li>
<li>
<em>get_per_version_config(base_config_filename [, major_version][, minor_version][,patch_version][, ...])</em>
Sources all config files matching the version, starting from the less sibling.</li>
<li>
<em>php_band_substitute(filename)</em>
Substitute placeholder with corresponding variable value.
A placeholder is the name of the variable enclosed by double brackets.
Most usefull placeholders are:

<ul>
<li>{{php_version}} The full php version string (for example 5.6.3RC2)</li>
<li>{{php_version_major}} The php major version (for example 5)</li>
<li>{{php_version_minor}} The php minor version (for example 6)</li>
<li>{{php_version_patch}} The php patch version (for example 3)</li>
<li>{{php_version_addon}} The php version (for example RC2)</li>
<li>{{php_band_php_install_dir}} The directory where php is installed</li>
</ul>
</li>
</ul>

<h1>
<a id="best-practises-in-writing-configuration-files" class="anchor" href="#best-practises-in-writing-configuration-files" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Best practises in writing configuration files</h1>

<p>The configuration file</p>

<ul>
<li>must not override protected variables</li>
<li>should not create global variables</li>
<li>if global variables are created, they should be prefixed with the <em>CUSTOM_</em> or <em>custom_</em> string (optionaly followed by your suffix)</li>
<li>functions not accepted by php-band should be prefixed by <em>custom_</em> (optionnally followed by you suffix)</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/francisek/php-band">Php-band</a> is maintained by <a href="https://github.com/francisek">francisek</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-73127413-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
